<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Initial Setup - YT2Radarr - Radarr YouTube Video Importer</title>
  <link
    rel="icon"
    type="image/svg+xml"
    sizes="any"
    href="{{ url_for('static', filename='yt2radarr-logo.svg') }}"
  />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <div class="app-shell">
    <div class="header">
      <div class="brand">
        <img
          src="{{ url_for('static', filename='yt2radarr-logo.svg') }}"
          alt="YT2Radarr logo"
          class="app-logo"
        />
        <h1>YT2Radarr - Radarr YouTube Video Importer</h1>
      </div>
      <div class="header-actions">
        {% if configured %}
          <a class="link-button" href="{{ url_for('index') }}">Back to App</a>
        {% endif %}
      </div>
    </div>

    <div class="page-layout">
      <div class="main-column">
        <form method="post" novalidate>
          <div class="form-section">
            <h2>Initial Configuration</h2>
            <p class="section-description">Provide the Radarr connection details and library locations required for the importer to run.</p>

            {% if errors %}
              <div class="alerts">
                {% for error in errors %}
                  <div class="alert">{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}

            <div class="form-group">
              <label for="radarr_url">Radarr URL</label>
              <input
                type="url"
                id="radarr_url"
                name="radarr_url"
                placeholder="http://localhost:7878"
                value="{{ config.get('radarr_url', '') }}"
                required
              />
            </div>

            <div class="form-group">
              <label for="radarr_api_key">Radarr API Key</label>
              <input
                type="text"
                id="radarr_api_key"
                name="radarr_api_key"
                placeholder="Paste your Radarr API key"
                value="{{ config.get('radarr_api_key', '') }}"
                required
              />
            </div>

            <div class="form-check">
              <input
                type="checkbox"
                id="debug_mode"
                name="debug_mode"
                value="1"
                {% if config.get('debug_mode') %}checked{% endif %}
              />
              <label for="debug_mode">Enable verbose debug logging</label>
              <p class="form-note">When enabled, the debug console will include all yt-dlp output. Leave disabled to hide routine progress messages.</p>
            </div>
          </div>

          <div class="form-section">
            <h2>Library Locations</h2>
            <p class="section-description">Add every directory on this machine that already contains movies managed by Radarr.</p>

            <div class="form-group">
              <label for="file_paths">Movie Library Paths</label>
              <textarea
                id="file_paths"
                name="file_paths"
                placeholder="One accessible path per line"
                required
              >{{- config.get('file_paths', []) | join('\n') -}}</textarea>
            </div>

            <p class="form-note">The importer scans these folders to avoid downloading duplicates. Use absolute paths such as <code>/mnt/media/movies</code> or <code>C:\\Movies</code>.</p>
          </div>

          <div class="form-section">
            <h2>Path Overrides</h2>
            <p class="section-description">Translate Radarr’s remote paths to the directories available to this importer container or host.</p>

            <div class="form-group">
              <label for="path_overrides">Overrides</label>
              <textarea
                id="path_overrides"
                name="path_overrides"
                placeholder="/radarr/media =&gt; /importer/media"
              >{{- overrides_text -}}</textarea>
            </div>

            <div class="form-note">
              <strong>Format:</strong> one mapping per line using <code>radarr/path =&gt; /local/path</code>.
              Use the path Radarr sees inside its container or pod on the left, and the importer’s mount path on the right.
              The importer applies overrides before scanning the library directories above.
            </div>
          </div>

          <div class="form-section">
            <h2>YouTube Cookies (Optional)</h2>
            <p class="section-description">
              Paste a Netscape-format cookies file if the videos you save require a logged-in YouTube session. We store it inside
              the application’s configuration directory so it works anywhere you deploy the app.
            </p>

            {% if cookie_env_path %}
              <div class="form-note">
                <strong>Environment override:</strong> You have <code>YT_COOKIE_FILE</code> set to
                <code>{{ cookie_env_path }}</code>. That path always takes priority over the saved cookies below.
              </div>
            {% endif %}

            {% if resolved_cookie_path %}
              <div class="form-note">
                <strong>Active cookies:</strong> Using <code>{{ resolved_cookie_path }}</code> for yt-dlp requests.
              </div>
            {% endif %}

            <div class="form-group">
              <label for="cookie_text">Paste Cookies</label>
              <textarea
                id="cookie_text"
                name="cookie_text"
                placeholder="# Netscape HTTP Cookie File"
                rows="6"
              >{{ cookie_preview }}</textarea>
            </div>

            <div class="form-note">
              Generate this text with <code>yt-dlp --cookies-from-browser chrome</code> or export from your browser, then paste it here.
              We save it as <code>cookies.txt</code> under your chosen configuration directory with owner-only permissions so it stays private on the host.
            </div>

            <div class="form-check">
              <input type="checkbox" id="clear_cookies" name="clear_cookies" value="1" />
              <label for="clear_cookies">Remove saved cookies</label>
            </div>
          </div>

          <div class="form-section community-section">
            <h2>Community</h2>
            <p class="section-description">
              Made with love, ChatGPT, &amp; a deep hatred of manual labour by
              <a href="https://github.com/Gilmeyuhas" target="_blank" rel="noopener">Gil Meyuhas</a>.
            </p>
            <p class="form-note">
              This project is a personal hobby to simplify managing my own media library. If you have ideas or want to help, feel free to open an issue or send a pull request—contributions are very welcome!
            </p>
          </div>

          <button type="submit">Save Configuration</button>
        </form>
      </div>

      <aside class="side-column setup-tips">
        <div class="info-card">
          <h2>Need Help Locating Paths?</h2>
          <p>Open Radarr and inspect a movie’s <em>Media Info</em> tab to copy the path Radarr reports. Verify the same movie exists on this workstation before saving.</p>
        </div>
        <div class="info-card">
          <h2>Override Examples</h2>
          <ul>
            <li><code>/radarr/media =&gt; /importer/media</code> (Radarr container mount vs. importer container mount)</li>
            <li><code>/config/movies =&gt; /mnt/media/movies</code> (Radarr pod path translated to the host path available here)</li>
            <li><code>\\NAS\4K =&gt; D:\\Media\4K</code> (Network share mapped to a drive letter)</li>
          </ul>
          <p>Leave the overrides field empty if Radarr and this machine see the same file system.</p>
        </div>
      </aside>
    </div>
  </div>
</body>
</html>
